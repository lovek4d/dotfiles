t() {
  if [[ $# -gt 0 ]]; then
    tmux "$@"
    return
  fi
  cat <<'EOF'
tmux aliases:
  sessions
    tb  background command, notify on done
    td  detach
    tk  kill session (fzf)
    tl  list-sessions
    tn  new session <name>
    ts  switch session (fzf)

  panes
    trpd  resize pane down  5
    trpl  resize pane left  5
    trpr  resize pane right 5
    trpu  resize pane up    5

  keybindings (ctrl+b â€¦)
    "      split horizontal
    %      split vertical
    ,      rename window
    [      scroll / copy mode
    arrow  switch pane
    c      new window
    d      detach
    n / p  next / prev window
    space  command palette
    w      window list
    x      kill pane
    z      zoom pane

  settings
    set -g mouse on
EOF
}

# simple aliases
alias tl='tmux list-sessions'
alias td='tmux detach'
alias trpu='tmux resize-pane -U 5'
alias trpd='tmux resize-pane -D 5'
alias trpl='tmux resize-pane -L 5'
alias trpr='tmux resize-pane -R 5'

## create named session (avoids nesting)
tn() {
  if [[ -z "$1" ]]; then
    echo "usage: tn <name>" && return 1
  fi
  if [[ -n "$TMUX" ]]; then
    tmux new-session -ds "$1" && tmux switch-client -t "$1"
  else
    tmux new-session -s "$1"
  fi
}

## switch session (inline or fzf select)
ts() {
  if [[ -n "$1" ]]; then
    if [[ -n "$TMUX" ]]; then
      tmux switch-client -t "$1"
    else
      tmux attach -t "$1"
    fi
  else
    local session
    session=$(tmux list-sessions -F '#{session_name}' 2>/dev/null \
      | fzf --prompt='switch session> ' --height=40% --reverse)
    [[ -z "$session" ]] && return 1
    if [[ -n "$TMUX" ]]; then
      tmux switch-client -t "$session"
    else
      tmux attach -t "$session"
    fi
  fi
}

## background command with notification on completion
_tb_notify() {
  local rc=$1 cmd=$2 session=$3
  local tag="DONE" sound="Glass"
  [[ $rc -ne 0 ]] && tag="FAILED" && sound="Basso"
  tmux rename-session -t "$session" "${session}_${tag}" 2>/dev/null
  osascript -e "display notification \"$tag\" with title \"$cmd\" sound name \"$sound\""
  clear
  echo "[tb] $tag (exit $rc): $cmd"
  echo "press any key to close"
  read -k1
  exit
}

tb() {
  [[ -z "$1" ]] && echo "usage: tb <command...>" && return 1
  local name="bg-$(echo "$*" | awk '{for(i=1;i<=3&&i<=NF;i++) printf (i>1?"_":"") $i}')"
  if tmux has-session -t "$name" 2>/dev/null; then
    echo "already running $name" && return 1
  fi
  tmux new-session -ds "$name" \; \
    send-keys -t "$name" "$*; _tb_notify \$? '${*//\'/\'\\\'\'}' '$name'" Enter
  echo "running in '$name'"
}

## kill session (inline or fzf select)
tk() {
  if [[ -n "$1" ]]; then
    tmux kill-session -t "$1"
  else
    local session
    session=$(tmux list-sessions -F '#{session_name}' 2>/dev/null \
      | fzf --prompt='kill session> ' --height=40% --reverse)
    [[ -z "$session" ]] && return 1
    tmux kill-session -t "$session"
  fi
}
