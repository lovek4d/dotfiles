# core
alias g='git'
alias gaa='git add .'
alias gst='git status'
alias gpl='git pull --ff-only'
alias gps='git push'
alias gfal='git fetch --all --prune'

# log
alias gl='git log'
alias glo='git log --oneline'
alias glg='git log --graph'
alias glp='git log -p' # pass number of commits
alias glfs='git log -S' # pass string
alias glff='git log --all-match' # pass filename

# stash
alias gs='git stash'
alias gsm='git stash -m'
alias gsl='git stash list'
alias gsp='git stash pop'
alias gsa='git stash apply'
alias gss='git stash show -p'
alias gsdr='git stash drop'

# commits
alias gc='git commit'
alias gca='git commit --amend'
alias gcan='git commit --amend --no-edit'

# merging
alias gm='git merge'
alias gms='git merge --squash'
alias gmn='git merge --no-edit'
alias gmo='git merge -X ours'
alias gmt='git merge -X theirs'
alias gmon='git merge -X ours --no-edit'
alias gmtn='git merge -X theirs --no-edit'
alias gcp='git cherry-pick'
alias grb='git rebase'

# branches
alias gbr='git branch'
alias gsw='git switch'
alias gswap='git stash -m "switch staging" && git switch $1 && git stash pop'
alias gco='git checkout'

# resets
alias grh='git reset --hard'
alias grs='git reset --soft'

# copy diff (mac-centric)
alias gdc='git diff --color --patience | pbcopy && echo "Copied diff to clipboard"'

# branch list select switch
gswd() {
  local branch
  branch=$(git branch --all --format='%(refname:short)' \
    | sed 's#^remotes/##' \
    | sort -u \
    | fzf --prompt='switch> ' --height=40% --reverse)
  [[ -n "$branch" ]] && git switch "$branch"
}

# merge upstream (auto-detect main/master)
gum() {
  local base
  base="$(git symbolic-ref --short refs/remotes/origin/HEAD 2>/dev/null | cut -d/ -f2)"
  [ -z "$base" ] && base=main
  git fetch origin "$base" && git merge "origin/$base" --no-edit
}

# delete branches by pattern
gdl() {
  if [ -z "$1" ]; then
    echo "usage: gdl <pattern>"; return 1
  fi
  git branch | grep -E "$1" | sed 's/^\*//' | xargs -n1 git branch -D
}

# pull all git repos in current dir
gpla() {
  for dir in */; do
    [ -d "$dir/.git" ] || continue
    echo "=== Pulling $dir ==="
    git -C "$dir" pull --ff-only
  done
}
